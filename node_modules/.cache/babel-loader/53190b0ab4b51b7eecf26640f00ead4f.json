{"ast":null,"code":"import _regeneratorRuntime from\"/Users/bottlecapmedia/Documents/Applications/OneShot Parking/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/bottlecapmedia/Documents/Applications/OneShot Parking/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/bottlecapmedia/Documents/Applications/OneShot Parking/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useContext,useEffect}from'react';import{PaymentContext}from'../Context/PaymentContext';import{CardNumberElement,CardCvcElement,CardExpiryElement,useElements,useStripe}from'@stripe/react-stripe-js';import{loadStripe}from'@stripe/stripe-js';import Lock from'../Assets/lock.png';import CreditCardIcon from\"../Assets/ccIcon.svg\";import'../Pages/pages.css';import Loading from'../Components/Loading/Loading';import{withRouter,useHistory}from'react-router-dom';import bodyParser from'body-parser';import Header from'../Components/Header/Header';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var StripePayment=function StripePayment(){// using state to keep track of stripe payment, show errors, and manange user interface\nvar stripe=useStripe();var elements=useElements();var history=useHistory();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),success=_useState2[0],setSuccess=_useState2[1];var _useState3=useState({status:\"Enter your card's information below\"}),_useState4=_slicedToArray(_useState3,2),status=_useState4[0],setStatus=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),processing=_useState6[0],setProcessing=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),disabled=_useState8[0],setDisabled=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),clientSecret=_useState10[0],setClientSecret=_useState10[1];var _useContext=useContext(PaymentContext),userInfo=_useContext.userInfo,totalbilling=_useContext.totalbilling,darkMode=_useContext.darkMode;var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isPaymentLoading=_useState12[0],setPaymentLoading=_useState12[1];var _useState13=useState({globalContainer:'global_container',color:'#585858',submitBtn:'submitBtn',card:'card_'}),_useState14=_slicedToArray(_useState13,2),darkModeStyle=_useState14[0],setDarkModeStyle=_useState14[1];var api_data={'fullname':localStorage.getItem('fullname'),'license_plate':localStorage.getItem('license'),'set_time':localStorage.getItem('startTime'),'exp_time':localStorage.getItem('expTime'),'location_id':localStorage.getItem('lot'),'paid':localStorage.getItem('total')};useEffect(function(){if(darkMode>=1800||darkMode<=600){setDarkModeStyle({globalContainer:'global_container_dark',color:'white',submitBtn:'submitBtn_dark',card:'card_dark'});}},[darkMode]);var CARD_ELEMENT_OPTIONS={style:{base:{color:'black'}}};var calc_stripe_amount=function calc_stripe_amount(amount){var split_amount=amount.toString().split('.');var output=parseInt(\"\".concat(split_amount[0]).concat(split_amount[1]<10?\"\".concat(split_amount[1],\"0\"):split_amount[1]));return output;};var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var paymentResult;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();if(!(!stripe||!elements)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:_context.next=5;return fetch(\"https://osParking.pythonanywhere.com/create-payment-intent\",{method:'POST',headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({amount:calc_stripe_amount(api_data.paid),description:\"Purchased by \".concat(api_data.fullname,\" owner of \").concat(api_data.license_plate,\". Can be contacted at 6470001111\")})}).then(function(res){return res.json();}).then(function(data){setClientSecret(data.clientSecret);});case 5:console.log(\" New Secret: \".concat(clientSecret));setPaymentLoading(true);_context.next=9;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:elements.getElement(CardNumberElement,CardExpiryElement,CardCvcElement),billing_details:{name:\"Decory Herbert\"}}});case 9:paymentResult=_context.sent;setPaymentLoading(false);if(paymentResult.error){alert(paymentResult.error.message);console.log(paymentResult.error.message);}else{if(paymentResult.paymentIntent.status===\"succeeded\")setSuccess(true);setTimeout(function(){history.push('/remaining-time/');},2000);}case 12:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();// end of handle submit\nvar msg_data={'number':localStorage.getItem('phone')};var send_message=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!success){_context2.next=3;break;}_context2.next=3;return fetch('https://osparking.pythonanywhere.com/on-payment',{method:'POST',mode:'cors',headers:{'Access-Control-Allow-Origin':'*','Content-Type':'application/json'},body:JSON.stringify(msg_data)}).then(function(promise){return promise.json();}).then(function(data){console.log(data);});case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function send_message(){return _ref2.apply(this,arguments);};}();send_message();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Header,{home:false}),/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(darkModeStyle.globalContainer,\" choose_lot\"),children:stripe?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"global_content_title slim\",style:{textAlign:'center',marginTop:'-50%',color:darkModeStyle.color},children:status.status}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:darkModeStyle.card,children:[\" \",/*#__PURE__*/_jsxs(\"div\",{className:\"stacked_\",children:[/*#__PURE__*/_jsx(\"label\",{style:{color:'black'},id:\"CCnumberLabel\",children:\"Enter Your Card Number\"}),/*#__PURE__*/_jsx(\"div\",{id:\"CCnumber\",children:/*#__PURE__*/_jsx(CardNumberElement,{options:CARD_ELEMENT_OPTIONS})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"auth_holder\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stacked_\",children:[/*#__PURE__*/_jsx(\"label\",{style:{color:darkModeStyle.color},children:\"Expiration\"}),/*#__PURE__*/_jsx(\"div\",{id:\"expiration\",children:/*#__PURE__*/_jsx(CardExpiryElement,{options:CARD_ELEMENT_OPTIONS})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stacked_\",children:[/*#__PURE__*/_jsx(\"label\",{style:{color:darkModeStyle.color},children:\"CVC\"}),/*#__PURE__*/_jsx(\"div\",{id:\"cvc\",children:/*#__PURE__*/_jsx(CardCvcElement,{options:CARD_ELEMENT_OPTIONS})})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"img\",{className:\"ccIcon\",src:CreditCardIcon,alt:\"creditCard_logo\"})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"securePaymentHolder\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"securePayment_\",children:[\"  \",/*#__PURE__*/_jsx(\"img\",{className:\"lock\",src:Lock,alt:\"lock\"}),/*#__PURE__*/_jsx(\"p\",{style:{color:darkModeStyle.color},children:\"Secure Payment\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"ccCardSubmissionHolder\",children:/*#__PURE__*/_jsx(\"input\",{style:success?{backgroundColor:'green',color:'white',fontWeight:'bold',border:'1px solid green !important'}:{color:'#FF5759',border:'1px solid #FF5759 !important'},className:\"\".concat(darkModeStyle.submitBtn,\" ccCardSubmission\"),type:\"submit\",value:success?'Approved!':'Pay Now'})})]})]}):/*#__PURE__*/_jsx(Loading,{})})]});};export default StripePayment;// const { error, paymentMethod } = await stripe.createPaymentMethod({\n//     type: 'card',\n//     card: element.getElement(CardNumberElement, CardExpiryElement, CardCvcElement),\n// })\n// if (!error) {\n//     try {\n//         setTimeout(() => {\n//        \n//         }, 2000)\n//         setSuccess(true)\n//         // const { id } = paymentMethod\n//         fetch('https://osparking.pythonanywhere.com/visitor', {\n//             method: 'POST',\n//             mode: 'cors',\n//             headers: {\n//                 'Access-Control-Allow-Origin':'*',\n//                 'Content-Type': 'application/json'\n//             },\n//             body: JSON.stringify(api_data)\n//         }).then(response => response.json())\n//             .then(data => {\n//                 console.log('Success:', data);\n//             })\n//             .catch((error) => {\n//                 console.error('Error:', error);\n//             });\n//     } catch (error) {\n//         // Change the title information\n//         setStatus({\n//             status: error\n//         })\n//     }\n// }\n// const { error, paymentMethod } = await stripe.createPaymentMethod({\n//     type: 'card',\n//     card: elements.getElement(CardNumberElement, CardExpiryElement, CardCvcElement),\n// })","map":{"version":3,"sources":["/Users/bottlecapmedia/Documents/Applications/OneShot Parking/src/Stripe/Stripe-CC-Payment.js"],"names":["React","useState","useContext","useEffect","PaymentContext","CardNumberElement","CardCvcElement","CardExpiryElement","useElements","useStripe","loadStripe","Lock","Loading","withRouter","useHistory","bodyParser","Header","StripePayment","stripe","elements","history","success","setSuccess","status","setStatus","processing","setProcessing","disabled","setDisabled","clientSecret","setClientSecret","userInfo","totalbilling","darkMode","isPaymentLoading","setPaymentLoading","globalContainer","color","submitBtn","card","darkModeStyle","setDarkModeStyle","api_data","localStorage","getItem","CARD_ELEMENT_OPTIONS","style","base","calc_stripe_amount","amount","split_amount","toString","split","output","parseInt","handleSubmit","e","preventDefault","fetch","method","headers","body","JSON","stringify","paid","description","fullname","license_plate","then","res","json","data","console","log","confirmCardPayment","payment_method","getElement","billing_details","name","paymentResult","error","alert","message","paymentIntent","setTimeout","push","msg_data","send_message","mode","promise","textAlign","marginTop","CreditCardIcon","backgroundColor","fontWeight","border"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useEffect } from 'react'\nimport { PaymentContext } from '../Context/PaymentContext'\nimport { CardNumberElement, CardCvcElement, CardExpiryElement, useElements, useStripe } from '@stripe/react-stripe-js'\nimport { loadStripe } from '@stripe/stripe-js'\nimport Lock from '../Assets/lock.png'\nimport CreditCardIcon from '../Assets/ccIcon.svg'\nimport '../Pages/pages.css'\nimport Loading from '../Components/Loading/Loading'\nimport { withRouter, useHistory } from 'react-router-dom'\nimport bodyParser from 'body-parser'\nimport Header from '../Components/Header/Header'\n\n\nconst StripePayment = () => {\n    // using state to keep track of stripe payment, show errors, and manange user interface\n    const stripe = useStripe()\n    const elements = useElements()\n    const history = useHistory()\n\n\n    const [success, setSuccess] = useState(false)\n    const [status, setStatus] = useState({\n        status: \"Enter your card's information below\"\n    })\n    const [processing, setProcessing] = useState('')\n    const [disabled, setDisabled] = useState(true)\n    const [clientSecret, setClientSecret] = useState('')\n    const { userInfo, totalbilling, darkMode } = useContext(PaymentContext)\n    const [isPaymentLoading, setPaymentLoading] = useState(false)\n    const [darkModeStyle, setDarkModeStyle] = useState({\n        globalContainer: 'global_container',\n        color: '#585858',\n        submitBtn: 'submitBtn',\n        card: 'card_'\n    })\n\n    const api_data = {\n        'fullname': localStorage.getItem('fullname'),\n        'license_plate': localStorage.getItem('license'),\n        'set_time': localStorage.getItem('startTime'),\n        'exp_time': localStorage.getItem('expTime'),\n        'location_id': localStorage.getItem('lot'),\n        'paid': localStorage.getItem('total')\n    }\n\n    useEffect(() => {\n        if (darkMode >= 1800 || darkMode <= 600) {\n            setDarkModeStyle({\n                globalContainer: 'global_container_dark',\n                color: 'white',\n                submitBtn: 'submitBtn_dark',\n                card: 'card_dark'\n            })\n        }\n\n    }, [darkMode])\n\n    const CARD_ELEMENT_OPTIONS = {\n        style: {\n            base: {\n                color: 'black' \n            }\n        }\n    }\n\n\n    const calc_stripe_amount = (amount) => { \n        const split_amount = amount.toString().split('.')\n        const output  = parseInt(`${split_amount[0]}${split_amount[1] < 10?`${split_amount[1]}0`:split_amount[1] }`)\n        return output\n    }\n\n    const handleSubmit = async (e) => {\n        e.preventDefault()\n\n        if(!stripe || !elements) { \n            //Stripe JS has not been loaded. Disable form submisison\n            return;\n        }\n        // We need to fetch the client secrete from the Server \n        // in order to confirmCardPayments\n          await fetch(\"https://osParking.pythonanywhere.com/create-payment-intent\", { \n                method: 'POST', \n                headers: {\"Content-Type\": \"application/json\"}, \n                body: JSON.stringify({ \n                    amount: calc_stripe_amount(api_data.paid), \n                    description: `Purchased by ${api_data.fullname} owner of ${api_data.license_plate}. Can be contacted at 6470001111`,    \n                }),\n            }).then((res) => res.json())\n            .then((data) => { \n                setClientSecret(data.clientSecret) \n            })\n  \n\n        console.log(` New Secret: ${clientSecret}`)\n\n        setPaymentLoading(true)\n        const paymentResult = await stripe.confirmCardPayment(clientSecret, { \n            payment_method: { \n                card: elements.getElement(CardNumberElement, CardExpiryElement, CardCvcElement),\n                billing_details: {\n                    name: \"Decory Herbert\"\n                }\n            }\n        })\n        setPaymentLoading(false)\n        if(paymentResult.error){ \n            alert(paymentResult.error.message)\n            console.log(paymentResult.error.message)\n        }else{ \n            if(paymentResult.paymentIntent.status === \"succeeded\")\n            setSuccess(true)\n            setTimeout(()=> { \n                history.push('/remaining-time/')\n            }, 2000)\n        }\n\n\n    } // end of handle submit\n\n\n    const msg_data = {\n        'number': localStorage.getItem('phone'),\n    }\n    \n    const send_message = async () => {\n        if(success){\n            await fetch('https://osparking.pythonanywhere.com/on-payment', {\n                method: 'POST', \n                mode: 'cors', \n                headers: {\n                    'Access-Control-Allow-Origin':'*',\n                    'Content-Type': 'application/json'\n                },\n                body:JSON.stringify(msg_data)\n            })\n            .then((promise) => promise.json())\n            .then((data) => {\n                console.log(data)\n            })\n        }\n\n    }\n    send_message()\n\n\n    return (\n        <>\n\t\t<Header home={false}/>\n            <div className={`${darkModeStyle.globalContainer} choose_lot`}>\n                {stripe ?\n\n                    <div>\n                        <h1 className='global_content_title slim' style={{ textAlign: 'center', marginTop: '-50%', color: darkModeStyle.color }}>{status.status}</h1>\n                        <form onSubmit={handleSubmit} className={darkModeStyle.card}> {/* this should be a form */}\n                            {/* Enter your card numner */}\n                            <div className='stacked_'>\n                                {/* darkModeStyle.color */}\n                                <label style={{ color: 'black' }} id='CCnumberLabel'>Enter Your Card Number</label>\n                                <div id='CCnumber'>\n                                    <CardNumberElement options={CARD_ELEMENT_OPTIONS} />\n                                </div>\n                            </div>\n                            {/* Expiration CVC & Icon */}\n                            <div className='auth_holder'>\n                                <div className='stacked_'>\n                                    <label style={{ color: darkModeStyle.color }}>Expiration</label>\n                                    <div id='expiration'>\n                                        <CardExpiryElement options={CARD_ELEMENT_OPTIONS} />\n                                    </div>\n\n                                </div>\n                                <div className='stacked_'>\n                                    <label style={{ color: darkModeStyle.color }}>CVC</label>\n                                    <div id='cvc'>\n                                        <CardCvcElement options={CARD_ELEMENT_OPTIONS} />\n                                    </div>\n                                </div>\n                                <div>\n                                    <img className='ccIcon' src={CreditCardIcon} alt='creditCard_logo'></img>\n                                </div>\n                            </div>\n                            <div className='securePaymentHolder'>\n                                <div className='securePayment_'>  {/* display flex */}\n                                    {/* image */}\n                                    <img className='lock' src={Lock} alt='lock'></img>\n                                    <p style={{ color: darkModeStyle.color }}>Secure Payment</p>\n                                    {/* text info */}\n                                </div>\n                            </div>\n\n                            {/* Button here */}\n                            <div className='ccCardSubmissionHolder'>\n                                <input style={success ? { backgroundColor: 'green', color: 'white', fontWeight:'bold' ,border: '1px solid green !important' } : { color: '#FF5759', border: '1px solid #FF5759 !important' }} className={`${darkModeStyle.submitBtn} ccCardSubmission`} type='submit' value={success ? 'Approved!' : 'Pay Now'}></input>\n                            </div>\n\n\n                        </form>\n                    </div>\n                    :\n                    <Loading />\n                }\n            </div>\n        </>\n    )\n}\nexport default StripePayment;\n\n        // const { error, paymentMethod } = await stripe.createPaymentMethod({\n        //     type: 'card',\n        //     card: element.getElement(CardNumberElement, CardExpiryElement, CardCvcElement),\n        // })\n\n        // if (!error) {\n        //     try {\n        //         setTimeout(() => {\n        //        \n        //         }, 2000)\n        //         setSuccess(true)\n        //         // const { id } = paymentMethod\n\n        //         fetch('https://osparking.pythonanywhere.com/visitor', {\n        //             method: 'POST',\n        //             mode: 'cors',\n        //             headers: {\n        //                 'Access-Control-Allow-Origin':'*',\n        //                 'Content-Type': 'application/json'\n        //             },\n        //             body: JSON.stringify(api_data)\n        //         }).then(response => response.json())\n        //             .then(data => {\n        //                 console.log('Success:', data);\n        //             })\n        //             .catch((error) => {\n        //                 console.error('Error:', error);\n        //             });\n\n\n        //     } catch (error) {\n        //         // Change the title information\n        //         setStatus({\n        //             status: error\n        //         })\n        //     }\n        // }\n\n\n\n\n        // const { error, paymentMethod } = await stripe.createPaymentMethod({\n        //     type: 'card',\n        //     card: elements.getElement(CardNumberElement, CardExpiryElement, CardCvcElement),\n        // })"]},"metadata":{},"sourceType":"module"}